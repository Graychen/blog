<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Graychen,13780185250@sina.cn"><title>在k8s上部署dashboard后台管理界面 · Hexo</title><meta name="description" content="在昨天成功部署了k8s后，我今天尝试着部署它的后台web界面
下载官方的yaml1wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboa"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">Hexo</a></h3><div class="description"><p>这个世界需要更多的英雄</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/huashendung"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/1763295797/home?wvr=5"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/Graychen"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/archives">Arquivo</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="assets/blogImg/avatar.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>在k8s上部署dashboard后台管理界面</a></h3></div><div class="post-content"><p>在昨天成功部署了k8s后，我今天尝试着部署它的后台web界面</p>
<h1 id="下载官方的yaml"><a href="#下载官方的yaml" class="headerlink" title="下载官方的yaml"></a>下载官方的yaml</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br></pre></td></tr></table></figure>
<p>由于官方的yaml不直接对外开放，需要在本地直接进行<code>kubectl proxy</code>进行代理,所以我们通过修改yaml来直接暴露端口和服务。有两个地方要修改：</p>
<h2 id="第一个是修改镜像-kubernetes-dashboard-yaml配置文件112行"><a href="#第一个是修改镜像-kubernetes-dashboard-yaml配置文件112行" class="headerlink" title="第一个是修改镜像,kubernetes-dashboard.yaml配置文件112行"></a>第一个是修改镜像,kubernetes-dashboard.yaml配置文件112行</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> 90 # ------------------- Dashboard Deployment ------------------- #</span><br><span class="line"> 91 </span><br><span class="line"> 92 kind: Deployment</span><br><span class="line"> 93 apiVersion: apps/v1</span><br><span class="line"> 94 metadata:</span><br><span class="line"> 95 labels:</span><br><span class="line"> 96 k8s-app: kubernetes-dashboard</span><br><span class="line"> 97 name: kubernetes-dashboard</span><br><span class="line"> 98 namespace: kube-system</span><br><span class="line"> 99 spec:</span><br><span class="line">100 replicas: 1</span><br><span class="line">101 revisionHistoryLimit: 10</span><br><span class="line">102 selector:</span><br><span class="line">103 matchLabels:</span><br><span class="line">104 k8s-app: kubernetes-dashboard</span><br><span class="line">105 template:</span><br><span class="line">106 metadata:</span><br><span class="line">107 labels:</span><br><span class="line">108 k8s-app: kubernetes-dashboard</span><br><span class="line">109 spec:</span><br><span class="line">110 containers:</span><br><span class="line">111 - name: kubernetes-dashboard</span><br><span class="line">112 #image: k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1</span><br><span class="line">113 image: mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.0</span><br><span class="line">114 ports:</span><br><span class="line">115 - containerPort: 8443</span><br><span class="line">116 protocol: TCP</span><br></pre></td></tr></table></figure>
<h2 id="第二个是添加一个type-指定端口类型为-NodePort，这样外界可以通过地址-nodeIP-nodePort-访问-dashboard-kubernetes-dashboard-yaml配置文件158行"><a href="#第二个是添加一个type-指定端口类型为-NodePort，这样外界可以通过地址-nodeIP-nodePort-访问-dashboard-kubernetes-dashboard-yaml配置文件158行" class="headerlink" title="第二个是添加一个type,指定端口类型为 NodePort，这样外界可以通过地址 nodeIP:nodePort 访问 dashboard,kubernetes-dashboard.yaml配置文件158行:"></a>第二个是添加一个type,指定端口类型为 NodePort，这样外界可以通过地址 nodeIP:nodePort 访问 dashboard,kubernetes-dashboard.yaml配置文件158行:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">148 # ------------------- Dashboard Service ------------------- #</span><br><span class="line">149 </span><br><span class="line">150 kind: Service</span><br><span class="line">151 apiVersion: v1</span><br><span class="line">152 metadata:</span><br><span class="line">153 labels:</span><br><span class="line">154 k8s-app: kubernetes-dashboard</span><br><span class="line">155 name: kubernetes-dashboard</span><br><span class="line">156 namespace: kube-system</span><br><span class="line">157 spec:</span><br><span class="line">158 type: NodePort</span><br><span class="line">159 ports:</span><br><span class="line">160 - port: 443</span><br><span class="line">161 targetPort: 8443</span><br><span class="line">162 selector:</span><br><span class="line">163 k8s-app: kubernetes-dashboard</span><br></pre></td></tr></table></figure>
<h2 id="部署到k8s集群"><a href="#部署到k8s集群" class="headerlink" title="部署到k8s集群"></a>部署到k8s集群</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl apply <span class="_">-f</span> kubernetes-dashboard.yaml </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -n kube-system |grep dashboard</span></span><br><span class="line">kubernetes-dashboard-6685cb584f-xlk2h 1/1 Running 0 98s</span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods,svc -n kube-system</span></span><br><span class="line">NAME READY STATUS RESTARTS AGE</span><br><span class="line">pod/coredns-78d4cf999f-5hcjm 1/1 Running 0 3h21m</span><br><span class="line">pod/coredns-78d4cf999f-6mlql 1/1 Running 0 3h21m</span><br><span class="line">pod/etcd-k8sm-218 1/1 Running 0 3h20m</span><br><span class="line">pod/kube-apiserver-k8sm-218 1/1 Running 0 3h19m</span><br><span class="line">pod/kube-controller-manager-k8sm-218 1/1 Running 0 3h20m</span><br><span class="line">pod/kube-flannel-ds-amd64-6kfhg 1/1 Running 0 3h13m</span><br><span class="line">pod/kube-flannel-ds-amd64-c4fr4 1/1 Running 0 152m</span><br><span class="line">pod/kube-flannel-ds-amd64-qhc2w 1/1 Running 0 151m</span><br><span class="line">pod/kube-proxy-7hntq 1/1 Running 0 151m</span><br><span class="line">pod/kube-proxy-b4txb 1/1 Running 0 3h21m</span><br><span class="line">pod/kube-proxy-bz529 1/1 Running 0 152m</span><br><span class="line">pod/kube-scheduler-k8sm-218 1/1 Running 0 3h20m</span><br><span class="line">pod/kubernetes-dashboard-6685cb584f-xlk2h 1/1 Running 0 3m5s</span><br><span class="line"></span><br><span class="line">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span><br><span class="line">service/kube-dns ClusterIP 10.96.0.10 &lt;none&gt; 53/UDP,53/TCP 3h21m</span><br><span class="line">service/kubernetes-dashboard NodePort 10.104.4.26 &lt;none&gt; 443:30023/TCP 3m5s</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为我是阿里云的ecs，还要在安全组添加30023进入的端口才能在外部访问<br><img src="https://ws1.sinaimg.cn/large/6919c235gy1ga4315f1moj227u15mtg2.jpg" alt="截屏2019-12-21上午9.22.32.png"></p>
</blockquote>
<h2 id="Token-（令牌）-认证方式登录"><a href="#Token-（令牌）-认证方式登录" class="headerlink" title="Token （令牌） 认证方式登录"></a>Token （令牌） 认证方式登录</h2><p>1）授权 (所有 namespace )</p>
<p>// 创建serviceaccount<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl create serviceaccount dashboard-serviceaccount -n kube-system</span></span><br></pre></td></tr></table></figure></p>
<p>// 创建clusterrolebinding<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-serviceaccount</span></span><br></pre></td></tr></table></figure></p>
<p>2）获取令牌（用于网页登录）</p>
<p>// 查看口令列表<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl get secret -n kube-system |grep dashboard-serviceaccount-token</span></span><br><span class="line">dashboard-serviceaccount-token-f45wg kubernetes.io/service-account-token 3 22s</span><br></pre></td></tr></table></figure></p>
<p>// 获取口令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl describe secret dashboard-serviceaccount-token<span class="_">-f</span>45wg -n kube-system</span></span><br></pre></td></tr></table></figure></p>
<p>3）将获取到的token放在令牌里<br><img src="https://ws1.sinaimg.cn/large/6919c235gy1ga434bjbalj227k13sgsr.jpg" alt="截屏2019-12-21上午9.25.38.png"><br>4) 登录成功<br><img src="https://ws1.sinaimg.cn/large/6919c235gy1ga43c9j0ywj228011oq93.jpg" alt="截屏2019-12-21上午9.33.33.png"><br>5) 但是我还是遇到了<br><img src="https://ws1.sinaimg.cn/large/6919c235gy1ga43f7ljwhj227o108n06.jpg" alt="截屏2019-12-21上午9.36.05.png"><br>这个问题暂时还没有解决</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title=" 参考文章:"></a> 参考文章:</h2><p><a href="https://zhuanlan.zhihu.com/p/92923128" target="_blank" rel="noopener">30分钟带你搭建一套Dashboard的kubernetes（K8S）集群</a><br><a href="https://www.kubernetes.org.cn/2906.html" target="_blank" rel="noopener">使用kubeadm安装Kubernetes 1.8版本</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-12-20</span><i class="fa fa-tag"></i><a class="tag" href="/tags/devops/" title="devops">devops </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2019/12/20/在k8s上部署dashboard后台管理界面/,Hexo,在k8s上部署dashboard后台管理界面,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/12/21/helm在k8s上的部署/" title="helm在k8s上的部署">Post Anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/12/18/国内环境kubernetes安装/" title="国内环境利用kubeadm进行kubernetes安装">Próximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>